<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Rusha by srijs</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Rusha</h1>
        <p>A high-performance pure-javascript SHA1 implementation suitable for large binary data.</p>

        <p class="view"><a href="https://github.com/srijs/rusha">View the Project on GitHub <small>srijs/rusha</small></a></p>


        <ul>
          <li><a href="https://github.com/srijs/rusha/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/srijs/rusha/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/srijs/rusha">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>Prologue: The Sad State of Javascript SHA1 implementations</h2>

<p>When we started experimenting with alternative upload technologies at <a href="http://doctape.com">doctape</a> that required creating SHA1 hashes of the data locally on the client, it quickly became obvious that there were no performant pure-js implementations of SHA1 that worked correctly on binary data.</p>

<p>Jeff Motts <a href="http://code.google.com/p/crypto-js/">CryptoJS</a>, Brian Tureks <a href="http://caligatio.github.com/jsSHA/">jsSHA</a> and Tim Caswells <a href="http://github.com/openpeer/cifre">Cifre</a> were all hash functions that worked correctly on ASCII strings of a small size, but didn't scale to large data and/or didn't work correctly with binary data.</p>

<p>By modifying Paul Johnstons <a href="http://pajhome.org.uk/crypt/md5/sha1.html">sha1.js</a> slightly, it worked correctly on binary data but was unfortunately very slow, especially on V8. So a few days were invested on my side to implement a Johnston-inspired SHA1 hashing function with a heavy focus on performance.</p>

<p>The result of this process is Rusha, a SHA1 hash function that works flawlessly on large amounts binary data, such as binary strings or ArrayBuffers returned by the HTML5 File API, and leverages the soon-to-be-landed-in-firefox <a href="http://asmjs.org/spec/latest/">asm.js</a> with whose support its within <em>half of native speed</em>!</p>

<h2>Installing</h2>

<h3>Node.JS</h3>

<p>There is really no point in doing this, since Node.JS already has a wonderful <code>crypto</code> module that is leveraging low-level hardware instructions to perform really nice. Your can see the comparison below in the benchmarks.</p>

<p>Rusha is available on <a href="http://npmjs.org/">npm</a> via <code>npm install rusha</code>.</p>

<p>If you still want to do this, anyhow, just <code>require()</code> the <code>rusha.js</code> file, follow the instructions on <em>Using the Rusha Object</em>.</p>

<h3>Browser</h3>

<p>Rusha is available on <a href="http://twitter.github.com/bower/">bower</a> via <code>bower install rusha</code>.</p>

<p>It is highly recommended to run CPU-intensive tasks in a <a href="http://developer.mozilla.org/en-US/docs/DOM/Using_web_workers">Web Worker</a>. To do so, just start a worker with <code>var worker = new Worker('rusha.js')</code> and start sending it jobs. Follow the instructions on <em>Using the Rusha Worker</em>.</p>

<p>If you can't, for any reason, use Web Workers, include the <code>rusha.js</code> file in a <code>&lt;script&gt;</code> tag and follow the instructions on <em>Using the Rusha Object</em>.</p>

<h2>Using the Rusha Object</h2>

<p>Your instantiate a new Rusha object by doing <code>var r = new Rusha(optionalSizeHint)</code>. When created, it provides the following methods:</p>

<ul>
<li>
<code>Rusha#digestFromString(s)</code>: Create a hex digest from a binary <code>String</code>. A binary string is expected to only contain characters whose charCode &lt; 256.</li>
<li>
<code>Rusha#digestFromBuffer(b)</code>: Create a hex digest from a <code>Buffer</code> or <code>Array</code>. Both are expected to only contain elements &lt; 256.</li>
<li>
<code>Rusha#digestFromArrayBuffer(a)</code>: Create a hex digest from an <code>ArrayBuffer</code> object.</li>
</ul><h2>Using the Rusha Worker</h2>

<p>You can send your instance of the web worker messages in the format <code>{id: jobid, data: dataobject}</code>. The worker then sends back a message in the format <code>{id: jobid, hash: hash}</code>, were jobid is the id of the job previously received and hash is the hash of the data-object you passed, be it a <code>Blob</code>, <code>Array</code>, <code>Buffer</code>, <code>ArrayBuffer</code> or <code>String</code>.</p>

<h2>Benchmarks</h2>

<p>Tested were my Rusha implementation, the sha1.js implementation by <a href="http://pajhome.org.uk/crypt/md5/sha1.html">P. A. Johnston</a> and the Node.JS native implementation.</p>

<p>The best results for each implementation:</p>

<pre><code>   4096 bytes: Native:  0ms, Rusha:  1ms, Johnston:   3ms
1048576 bytes: Native:  4ms, Rusha: 11ms, Johnston:  55ms
4194304 bytes: Native: 17ms, Rusha: 41ms, Johnston: 211ms
8388608 bytes: Native: 37ms, Rusha: 80ms, Johnston: 428ms
</code></pre>

<p>All tests were performed on a MacBook Air 1.7 GHz Intel Core i5 and 4 GB 1333 MHz DDR3. Detailed results below.</p>

<p>Firefox Nightly (with asm.js support) 22.0a1:</p>

<pre><code>Benchmarking 4096 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted f1ea1aa67255487fb0991eff509a00dccab8d2d8 in 1 milliseconds
Johnst.  emitted f1ea1aa67255487fb0991eff509a00dccab8d2d8 in 3 milliseconds
Benchmarking 1048576 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted c9c163d357ad1f3d0a92af43b484d318cab23ef3 in 11 milliseconds
Johnst.  emitted c9c163d357ad1f3d0a92af43b484d318cab23ef3 in 57 milliseconds
Benchmarking 4194304 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted f0d461a6d6c4322360788ca18865538a621fb738 in 41 milliseconds
Johnst.  emitted f0d461a6d6c4322360788ca18865538a621fb738 in 217 milliseconds
Benchmarking 8388608 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted fc1c2906a58963ee56f1c37fc9bb637167637d41 in 80 milliseconds
Johnst.  emitted fc1c2906a58963ee56f1c37fc9bb637167637d41 in 428 milliseconds
</code></pre>

<p>Node (V8) 0.8.18:</p>

<pre><code>Benchmarking 4096 bytes ...
Native   emitted b180fa62481c53fcf86c21e7f6e319d4555ebd7a in 0 milliseconds
Rusha    emitted b180fa62481c53fcf86c21e7f6e319d4555ebd7a in 5 milliseconds
Johnst.  emitted b180fa62481c53fcf86c21e7f6e319d4555ebd7a in 3 milliseconds
Benchmarking 1048576 bytes ...
Native   emitted 6d7471eace53611faef8541b78d8130558a34070 in 4 milliseconds
Rusha    emitted 6d7471eace53611faef8541b78d8130558a34070 in 29 milliseconds
Johnst.  emitted 6d7471eace53611faef8541b78d8130558a34070 in 100 milliseconds
Benchmarking 4194304 bytes ...
Native   emitted bf8ed89073ea76ff9b9ac44d203f3c421669dd37 in 17 milliseconds
Rusha    emitted bf8ed89073ea76ff9b9ac44d203f3c421669dd37 in 110 milliseconds
Johnst.  emitted bf8ed89073ea76ff9b9ac44d203f3c421669dd37 in 431 milliseconds
Benchmarking 8388608 bytes ...
Native   emitted c9bbff50949da456fcf4d78093510f6e599e1568 in 37 milliseconds
Rusha    emitted c9bbff50949da456fcf4d78093510f6e599e1568 in 220 milliseconds
Johnst.  emitted c9bbff50949da456fcf4d78093510f6e599e1568 in 686 milliseconds
</code></pre>

<p>Chrome (V8) 25.0:</p>

<pre><code>Benchmarking 4096 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 67e1504a88a87adc7e6498872c8296030c501f52 in 5 milliseconds
Johnst.  emitted 67e1504a88a87adc7e6498872c8296030c501f52 in 9 milliseconds
Benchmarking 1048576 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 1339a85453885ee434a04a47f772d74b49ba6bac in 65 milliseconds
Johnst.  emitted 1339a85453885ee434a04a47f772d74b49ba6bac in 261 milliseconds
Benchmarking 4194304 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 4861c387e4c854f86e11e9e7f5565e5864235aa7 in 228 milliseconds
Johnst.  emitted 4861c387e4c854f86e11e9e7f5565e5864235aa7 in 844 milliseconds
Benchmarking 8388608 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 2f04698c8509c96e7fe15daa4e2385d1a1b1f0f0 in 462 milliseconds
Johnst.  emitted 2f04698c8509c96e7fe15daa4e2385d1a1b1f0f0 in 1929 milliseconds
</code></pre>

<p>Safari 6.0.2:</p>

<pre><code>Benchmarking 4096 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted c6f613ccd8b9a71945dccdd9268abe92f9796690 in 4 milliseconds
Johnst.  emitted c6f613ccd8b9a71945dccdd9268abe92f9796690 in 3 milliseconds
Benchmarking 1048576 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 134ad263901ee070bd2ff7848294fd898e6d834c in 32 milliseconds
Johnst.  emitted 134ad263901ee070bd2ff7848294fd898e6d834c in 83 milliseconds
Benchmarking 4194304 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 4e6a71b9e1d2d00ba73051198ed39397dad3db4b in 104 milliseconds
Johnst.  emitted 4e6a71b9e1d2d00ba73051198ed39397dad3db4b in 331 milliseconds
Benchmarking 8388608 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted f0f5d94371727bf4c413dadb722eee4af971931e in 281 milliseconds
Johnst.  emitted f0f5d94371727bf4c413dadb722eee4af971931e in 774 milliseconds
</code></pre>

<p>Firefox Aurora 21.0a2:</p>

<pre><code>Benchmarking 4096 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 2b06ba1f166c14bf66c21fc3c70fb9ca0e916cd3 in 6 milliseconds
Johnst.  emitted 2b06ba1f166c14bf66c21fc3c70fb9ca0e916cd3 in 4 milliseconds
Benchmarking 1048576 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 82eecaa400182aa0930c7b0b096583c3a69f300e in 22 milliseconds
Johnst.  emitted 82eecaa400182aa0930c7b0b096583c3a69f300e in 55 milliseconds
Benchmarking 4194304 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 9ad3fd23dd6d53466f4ee37a60c5b20e0d07fc4a in 71 milliseconds
Johnst.  emitted 9ad3fd23dd6d53466f4ee37a60c5b20e0d07fc4a in 211 milliseconds
Benchmarking 8388608 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted ae5472ffd492e410c764204409150989c9fda75a in 142 milliseconds
Johnst.  emitted ae5472ffd492e410c764204409150989c9fda75a in 434 milliseconds
</code></pre>

<p>Firefox 19.0.2:</p>

<pre><code>Native   emitted unavailable in 0 milliseconds
Rusha    emitted ced3abd7a93caf2a70edb3a9a795ffdaf43f67ed in 4 milliseconds
Johnst.  emitted ced3abd7a93caf2a70edb3a9a795ffdaf43f67ed in 3 milliseconds
Benchmarking 1048576 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted be0d6856f1bb92a7c9ffcf770adb2c463cc75053 in 57 milliseconds
Johnst.  emitted be0d6856f1bb92a7c9ffcf770adb2c463cc75053 in 56 milliseconds
Benchmarking 4194304 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted 308a4f69f3aa2723e3839833c93b8ed2cb7cd6d1 in 221 milliseconds
Johnst.  emitted 308a4f69f3aa2723e3839833c93b8ed2cb7cd6d1 in 218 milliseconds
Benchmarking 8388608 bytes ...
Native   emitted unavailable in 0 milliseconds
Rusha    emitted f46d1431b9e0c5aa30424f67267445fbb2cc619c in 406 milliseconds
Johnst.  emitted f46d1431b9e0c5aa30424f67267445fbb2cc619c in 433 milliseconds
</code></pre>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/srijs">srijs</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-38007063-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>